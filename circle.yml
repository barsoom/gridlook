test:
  # This pre step is just temporary until circleci install a newer version of rubygems. (>= 2.7.4 will make this unneeded)
  pre:
    - gem update --system
  override:
    - script/ci/pipeline.sh gridlook_tests "bundle exec rake"

deployment:
  apps:
    branch: master
    commands:
      # Deploys all apps listed in HEROKU_APP_NAMES

      # How it works:

      # - HEROKU_APP_NAMES contains a list of heroku app names separated by comma, e.g. "foo,bar,baz"
      # - sed splits the list into one line per app, e.g. "foo", then "bar", then "baz"
      # - xargs runs the deploy script for each app (the name of the current app is the variable "{}")
      - echo $HEROKU_APP_NAMES | sed s/,/\\n/g | xargs -I {} script/ci/pipeline.sh {}_deploy "script/ci/deploy.sh {}"
